{% extends 'includes/main.html' %} {% load static %} {% block content %}
<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <nav class="col-md-2 d-none d-md-block bg-dark sidebar">
      <!-- Sidebar content (optional) -->
    </nav>

    <!-- Main Content -->
    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
      <h1 class="mt-4">E-commerce Dashboard</h1>

      <!-- Top Metric Cards -->
      <div class="row">
        <!-- Total Sales Card -->
        <div class="col-md-3">
          <div class="card text-white bg-primary mb-4">
            <div class="card-body">
              <h5 class="card-title">Total Sales</h5>
              <p id="total-sales" class="card-text display-5">Loading...</p>
            </div>
          </div>
        </div>
        <!-- Total Orders Card -->
        <div class="col-md-3">
          <div class="card text-white bg-success mb-4">
            <div class="card-body">
              <h5 class="card-title">Total Orders</h5>
              <p id="total-orders" class="card-text display-5">Loading...</p>
            </div>
          </div>
        </div>
        <!-- Total Customers Card -->
        <div class="col-md-3">
          <div class="card text-white bg-info mb-4">
            <div class="card-body">
              <h5 class="card-title">Total Customers</h5>
              <p id="total-customers" class="card-text display-5">Loading...</p>
            </div>
          </div>
        </div>
        <!-- Total Products Card -->
        <div class="col-md-3">
          <div class="card text-white bg-warning mb-4">
            <div class="card-body">
              <h5 class="card-title">Total Products</h5>
              <p id="total-products" class="card-text display-5">Loading...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="row">
        <!-- Sales Overview Chart -->
        <div class="col-md-6">
          <div class="card mb-4">
            <div class="card-header">Sales Overview</div>
            <div class="card-body">
              <canvas id="salesChart"></canvas>
            </div>
          </div>
        </div>
        <!-- Orders Overview Chart -->
        <div class="col-md-6">
          <div class="card mb-4">
            <div class="card-header">Orders Overview</div>
            <div class="card-body">
              <canvas id="ordersChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Orders Table -->
      <div class="card mb-4">
        <div class="card-header">Recent Orders</div>
        <div class="card-body">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Order ID</th>
                <th>Customer</th>
                <th>Date</th>
                <th>Status</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody id="recent-orders">
              <tr>
                <td colspan="5">Loading...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Footer -->
      <footer class="pt-5 d-flex justify-content-between">
        <span>© 2023 E-commerce Dashboard</span>
      </footer>
    </main>
  </div>
</div>

{% endblock %} {% block js %}
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Chart.js Scripts -->
<script>
  // Fetch dynamic data for the dashboard
  document.addEventListener("DOMContentLoaded", function () {
    fetch("/ecommerce/dashboard-data/")
      .then((response) => response.json())
      .then((data) => {
        // Update Total Sales
        const totalSales = isNaN(data.total_sales) ? 0 : data.total_sales;
        document.getElementById(
          "total-sales"
        ).textContent = `৳${totalSales.toFixed(2)}`;

        // Update Total Orders
        document.getElementById("total-orders").textContent = data.total_orders;

        // Update Total Customers
        document.getElementById("total-customers").textContent =
          data.total_customers;

        // Update Total Products
        document.getElementById("total-products").textContent =
          data.total_products;

        // Update Recent Orders Table
        const ordersTable = document.getElementById("recent-orders");
        ordersTable.innerHTML = ""; // Clear existing rows
        data.recent_orders.forEach((order, index) => {
          const row = `
                <tr class="${index % 2 === 0 ? "table-light" : ""}">
                    <td>#${order.id}</td>
                    <td>BDT. {order.user__name || "Guest"}</td>
                    <td>BDT. {new Date(order.created_at).toLocaleDateString()}</td>

                    <td><span class="badge bg-${getStatusBadge(
                      order.status
                    )}">${capitalize(order.status)}</span></td>

                    <td>৳${order.total_amount.toFixed(2)}</td>
                </tr>
            `;
          ordersTable.innerHTML += row;
        });
      })
      .catch((error) => {
        console.error("Error fetching dashboard data:", error);
      });

    function getStatusBadge(status) {
      const badges = {
        delivered: "success",
        shipped: "warning",
        processing: "warning",
        pending: "warning",
        refunded: "danger",
        cancelled: "danger",
      };
      return badges[status] || "secondary";
    }
  });
  function capitalize(str) {
    return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
  }
  function getStatusBadge(status) {
    // Map order status to badge classes
    const badges = {
      completed: "success",
      pending: "warning",
      cancelled: "danger",
    };
    return badges[status] || "secondary";
  }

  // Sales Overview Line Chart
  const salesCtx = document.getElementById("salesChart").getContext("2d");
  const salesChart = new Chart(salesCtx, {
    type: "line",
    data: {
      labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep"],
      datasets: [
        {
          label: "Sales",
          data: [3000, 4000, 3200, 4500, 5000, 6000, 7000, 8000, 7500],
          backgroundColor: "rgba(54, 162, 235, 0.2)",
          borderColor: "rgba(54, 162, 235, 1)",
          borderWidth: 2,
          fill: true,
          tension: 0.4,
        },
      ],
    },
    options: {
      scales: {
        y: { beginAtZero: true },
      },
      plugins: {
        legend: { display: false },
      },
    },
  });

  // Orders Overview Bar Chart
  const ordersCtx = document.getElementById("ordersChart").getContext("2d");
  const ordersChart = new Chart(ordersCtx, {
    type: "bar",
    data: {
      labels: [
        "Electronics",
        "Clothing",
        "Accessories",
        "Home & Garden",
        "Sports",
      ],
      datasets: [
        {
          label: "Orders",
          data: [500, 300, 200, 400, 150],
          backgroundColor: [
            "rgba(255, 99, 132, 0.7)",
            "rgba(54, 162, 235, 0.7)",
            "rgba(255, 206, 86, 0.7)",
            "rgba(75, 192, 192, 0.7)",
            "rgba(153, 102, 255, 0.7)",
          ],
          borderColor: [
            "rgba(255,99,132,1)",
            "rgba(54,162,235,1)",
            "rgba(255,206,86,1)",
            "rgba(75,192,192,1)",
            "rgba(153,102,255,1)",
          ],
          borderWidth: 1,
        },
      ],
    },
    options: {
      indexAxis: "y",
      scales: {
        x: { beginAtZero: true },
      },
      plugins: {
        legend: { display: false },
      },
    },
  });
</script>
<style>
  /* Remove background and style the status */
  .status-label {
    font-size: 14px; /* Adjust text size */
    color: #333; /* Text color */
    padding: 2px 6px; /* Padding for better spacing */
    border: 1px solid #ddd; /* Optional: Add border */
    border-radius: 3px; /* Optional: Border radius */
  }
</style>
{% endblock %}
